# Flask数据库

### MySQL安装(都是在Mac下)
```
下载安装，安装完后会弹窗给初始密码

在~/.zshrc添加(你也用zsh的话）：
export PATH=${PATH}:/usr/local/mysql/bin 

mysql -u root
输入mysql安装完后弹窗给的初始化密码

show databases;
会提示修改密码

设置密码
SET PASSWORD FOR 'root'@'localhost' = PASSWORD('Mysqlpassw0rd');  
```

### MySQL-python中间件的介绍与安装
- 安装：进入虚拟环境，`sudo pip install mysql-python`。

### Flask-SQLAlchemy的介绍与安装
1. Flask-SQLAlchemy是一套ORM框架。
2. ORM：Object Relationship Mapping(模型关系映射)。
3. ORM的好处：可以让我们操作数据库和操作对象是一样的，非常方便。因为一个表就抽象成一个类，一条数据就抽象成该类的一个对象。
4. 安装：`pip install flask-sqlalchemy`。

### Flask-SQLAlchemy的使用
1. 初始化和设置数据库配置信息
	- 使用`flask-sqlalchemy中的SQLALchemy进行初始化`
	```
	from flask_sqlalchemy import SQLAlchemy
	app = Flask(__name__)
	db = SQLAlchemy(app)
	```
2. 设置配置信息：在`config.py`中添加以下配置信息
	```
	# encoding: utf-8

	# SQLALCHEMY_DB
	# dialect+driver://username:password@host:port/database
	DIALECT = 'mysql'
	DRIVER = 'mysqldb'
	USERNAME = 'root'
	PASSWORD = 'xxx'
	HOST = '127.0.0.1'
	PORT = '3306'
	DATABASE = 'db_demo1'

	DB_URI = "{}+{}://{}:{}@{}:{}/{}?charset=utf8".format(DIALECT, DRIVER, USERNAME, PASSWORD, HOST, PORT, DATABASE)
	SQLALCHEMY_DATABASE_URI = DB_URI
	SQLALCHEMY_TRACK_MODIFICATIONS = False
	```
3. 在主app文件中添加配置文件
	```
	app = Flask(__name__)
	app.config.from_object(config)
	db = SQLAlchemy(app)
	```
4. 做测试，看有没有问题
	```
	db.create_all()
	```
	- 如果有报错，则配置有问题，根据报错修改。


### 使用Flask-SQLAlchemy创建模型与表的映射
1. 模型需要继承自`db.Model`，然后需要映射到表中的属性，必须写成`db.Column`的数据类型。
2. 数据类型：
	- `db.Integer`代表整型
	- `db.String`代表`varchar`，需要指定最长的长度。
	- `db.Text`代表`text`。
3. 其它参数：
	- `primary_key`：代表将这个字段设为主键
	- `autoincrement`：代表这个主键为自增长的
	- `nullable`：代表这个字段是否可以为空，默认可以为空，可设为False
4. 最后需要调用`db.create_all`来将模型真正的创建到数据库。
	```
	class Article(db.Model):
	    # 指定表名，不指定会为article
	    __tablename__ = 'article'
	    id = db.Column(db.Integer, primary_key=True, autoincrement=True)
	    title = db.Column(db.String(100), nullable=False)
	    content = db.Column(db.Text, nullable=False)

	db.create_all()
	```

### Flask-SQLAlchemy数据的增，删，改，查
1. 增：
	```
    # 增：
    article1 = Article(title='aaa', content='bbb')
    # 事务操作
    db.session.add(article1)
    # 提交
    db.session.commit()
	```
2. 查：
	```
	# 查
    # select * from article where title='aaa';
    article1 = Article.query.filter(Article.title == 'aaa').first()
    print 'title: %s' % article1.title
    print 'content: %s' % article1.content
	```
3. 改：
	```
	# 改
    # 1. 先查找数据
    article1 = Article.query.filter(Article.title == 'aaa').first()
    # 2. 把这条数据要修改的地方进行修改
    article1.title = 'new title'
    # 3. 事务提交
    db.session.commit()
	```
4. 删
	```
    # 删
    # 1. 先查找数据
    article1 = Article.query.filter(Article.content == 'bbb').first()
    # 2. 删这条数据
    db.session.delete(article1)
    # 3. 事务提交
	```

























